# MoveTo 轨迹规划使用说明

## 功能概述

新增的 `moveto` 功能允许用户指定一个目标位姿(基于 waist_link 坐标系),机械臂将从当前位姿平滑移动到目标位姿。

## 使用方法

### 基本语法

```bash
./demo_drake_mujoco_cosim moveto [duration] [timestep] x y z [qx qy qz qw]
```

### 参数说明

- `moveto`: 轨迹类型,指定为点对点运动
- `duration`: 运动时间(秒),默认 5.0 秒
- `timestep`: 仿真步长(秒),默认 0.001 秒
- `x y z`: 目标位置(米),相对于 waist_link 坐标系
- `qx qy qz qw`: (可选) 目标姿态的四元数表示

### 使用示例

#### 示例 1: 只指定目标位置(保持初始姿态)

```bash
./demo_drake_mujoco_cosim moveto 3.0 0.001 0.3 0.2 0.5
```

这将使机械臂在 3 秒内移动到 waist_link 坐标系中的位置 (0.3, 0.2, 0.5) 米。

#### 示例 2: 指定目标位置和姿态

```bash
./demo_drake_mujoco_cosim moveto 3.0 0.001 0.3 0.2 0.5 0 0 0 1
```

四元数 (0, 0, 0, 1) 表示保持初始姿态(单位旋转)。

#### 示例 3: 指定旋转姿态

```bash
./demo_drake_mujoco_cosim moveto 4.0 0.001 0.4 0.0 0.3 0 0 0.707 0.707
```

四元数 (0, 0, 0.707, 0.707) 表示绕 Z 轴旋转 90 度。

## 坐标系说明

- **waist_link 坐标系**: 这是机械臂腰部的固定坐标系
- X 轴: 机械臂前方
- Y 轴: 机械臂左侧
- Z 轴: 垂直向上

## 技术实现

1. **笛卡尔空间轨迹规划**: 在笛卡尔空间中进行点对点插值
2. **位置插值**: 线性插值
3. **姿态插值**: SLERP (球面线性插值)
4. **逆运动学求解**: 使用 Drake 的全局 IK 求解器
5. **轨迹平滑**: 使用三次 Hermite 样条进行平滑

## 注意事项

1. 目标位置必须在机械臂工作空间内
2. 如果未指定四元数,将保持末端执行器的初始姿态
3. 运动时间不宜过短,建议 3-5 秒以获得平滑运动
4. 如果 IK 求解失败,系统将尝试使用前一个有效配置

## 其他轨迹类型

- `circular`: 圆形轨迹
- `line`: 线性轨迹(自动计算目标点)
- `moveto`: 自定义目标位姿

## 默认参数

如果未指定目标位置,默认目标为:
- 位置: (0.3, 0.2, 0.5) 米
- 姿态: 单位四元数 (0, 0, 0, 1)
